{"ast":null,"code":"import { SmartContract, Account, parseUserKey, GasLimit, Address, ContractFunction, Balance, U32Value } from \"@elrondnetwork/erdjs\";\n//import { Provider } from \"react\";\nimport data from \"./wallet.json\";\nimport axios from \"axios\";\nlet LoggedUseraddress = \"\";\nexport const getMintTransaction = (contractAddress, baseGasLimit, tokensAmount, tokenSellingPrice) => {\n  const contract = new SmartContract({\n    address: new Address(contractAddress)\n  });\n  return contract.call({\n    func: new ContractFunction(\"mint\"),\n    gasLimit: new GasLimit(baseGasLimit * tokensAmount),\n    args: [new U32Value(tokensAmount)],\n    value: Balance.fromString(tokenSellingPrice.toString()).times(tokensAmount)\n  });\n};\nexport const GetPrice = (contractAddress, baseGasLimit) => {\n  const contract = new SmartContract({\n    address: new Address(contractAddress)\n  });\n  return contract.call({\n    func: new ContractFunction(\"getNftPrice\"),\n    gasLimit: new GasLimit(baseGasLimit)\n  });\n};\n_c = GetPrice;\nexport const GetAddress = async LoggedUserAddress => {\n  LoggedUseraddress = LoggedUserAddress;\n};\n_c2 = GetAddress;\nexport const prepareUserAccount = async walletPemKey => {\n  const userKey = parseUserKey(walletPemKey);\n  const address = userKey.generatePublicKey().toAddress();\n  return new Account(address);\n};\nexport const publicEndpointSetup = async provider => {\n  let keyFileObject = JSON.parse(JSON.stringify(data)); // Provider type based on initial configuration\n\n  let LoggedUserAddress = new Address(LoggedUseraddress);\n  let LoggedUserAccount = new Account(LoggedUserAddress);\n  let syncc = await LoggedUserAccount.sync(provider);\n  console.log(syncc); //const signer = UserSigner.fromWallet(keyFileObject, \"u!D?G8Tf48fYL28\");\n\n  return {\n    signer,\n    LoggedUserAccount,\n    provider\n  };\n};\nexport const MintTransaction = async (price, tokens, signer, UserAccount, provider) => {\n  let mintx = getMintTransaction(\"erd1qqqqqqqqqqqqqpgqjwnulxe3eyevsgyslqqfw8ev5juwd6ew5uhsk8ye2g\", 18000000, tokens, price);\n  mintx.setNonce(UserAccount.getNonceThenIncrement());\n  signer.sign(mintx);\n  await mintx.send(provider);\n  await mintx.awaitExecuted(provider);\n  const mnttxHash = mintx.getHash();\n  return mnttxHash;\n};\n_c3 = MintTransaction;\nexport const PriceTransaction = async (signer, UserAccount, provider) => {\n  let pricetx = GetPrice(\"erd1qqqqqqqqqqqqqpgqjwnulxe3eyevsgyslqqfw8ev5juwd6ew5uhsk8ye2g\", 18000000);\n  console.log(UserAccount.nonce);\n  pricetx.setNonce(UserAccount.getNonceThenIncrement());\n  await signer.sign(pricetx);\n  console.log(UserAccount);\n  await pricetx.send(provider);\n  await pricetx.awaitExecuted(provider);\n  const txHash = pricetx.getHash();\n  axios.defaults.headers.post['Access-Control-Allow-Origin'] = '*';\n  console.log(`Transaction: https://devnet-explorer.elrond.com/transactions/${txHash}`);\n  let explorer = `https://devnet-gateway.elrond.com/transaction/${txHash}?withResults=true`;\n  let res = await axios.get(explorer);\n  let value = res.data.data.transaction.smartContractResults[0].data;\n  console.log(value);\n  var result = value.substring(value.lastIndexOf(\"@\") + 1);\n  return parseInt(result, 16);\n};\n_c4 = PriceTransaction;\n\nvar _c, _c2, _c3, _c4;\n\n$RefreshReg$(_c, \"GetPrice\");\n$RefreshReg$(_c2, \"GetAddress\");\n$RefreshReg$(_c3, \"MintTransaction\");\n$RefreshReg$(_c4, \"PriceTransaction\");","map":{"version":3,"names":["SmartContract","Account","parseUserKey","GasLimit","Address","ContractFunction","Balance","U32Value","data","axios","LoggedUseraddress","getMintTransaction","contractAddress","baseGasLimit","tokensAmount","tokenSellingPrice","contract","address","call","func","gasLimit","args","value","fromString","toString","times","GetPrice","GetAddress","LoggedUserAddress","prepareUserAccount","walletPemKey","userKey","generatePublicKey","toAddress","publicEndpointSetup","provider","keyFileObject","JSON","parse","stringify","LoggedUserAccount","syncc","sync","console","log","signer","MintTransaction","price","tokens","UserAccount","mintx","setNonce","getNonceThenIncrement","sign","send","awaitExecuted","mnttxHash","getHash","PriceTransaction","pricetx","nonce","txHash","defaults","headers","post","explorer","res","get","transaction","smartContractResults","result","substring","lastIndexOf","parseInt"],"sources":["/home/mmo/workspace/NFT_Minting_dApp/src/pages/Home/utils.ts"],"sourcesContent":["import {\n  ProxyProvider,\n  SmartContract,\n  Account,\n  parseUserKey,\n  UserSigner,\n  GasLimit,\n  Address,\n  ContractFunction,\n  Balance,\n  U32Value,\n  Transaction,\n  ISigner,\n  QueryResponse,\n} from \"@elrondnetwork/erdjs\";\nimport { Provider } from \"react\";\n//import { Provider } from \"react\";\nimport data from \"./wallet.json\";\nimport axios, { AxiosResponse } from \"axios\";\nlet LoggedUseraddress = \"\";\n\nexport const getMintTransaction = (\n  contractAddress: string,\n  baseGasLimit: number,\n  tokensAmount: number,\n  tokenSellingPrice: number,\n) => {\n  const contract = new SmartContract({\n    address: new Address(contractAddress),\n  });\n  return contract.call({\n    func: new ContractFunction(\"mint\"),\n    gasLimit: new GasLimit(\n      baseGasLimit * (tokensAmount)\n    ),\n    args: [new U32Value(tokensAmount)],\n    value: Balance.fromString(tokenSellingPrice.toString()).times(tokensAmount),\n  });\n};\n\nexport const GetPrice = (\n  contractAddress: string,\n  baseGasLimit: number,\n) => {\n  const contract = new SmartContract({\n    address: new Address(contractAddress),\n  });\n  return contract.call({\n    func: new ContractFunction(\"getNftPrice\"),\n    gasLimit: new GasLimit(\n      baseGasLimit\n    )\n  });\n};\n\nexport const GetAddress = async (LoggedUserAddress: string) => {\n  LoggedUseraddress = LoggedUserAddress;\n};\nexport const prepareUserAccount = async (walletPemKey: string) => {\n  const userKey = parseUserKey(walletPemKey);\n  const address = userKey.generatePublicKey().toAddress();\n  return new Account(address);\n};\n\nexport const publicEndpointSetup = async (provider: ProxyProvider) => {\n  let keyFileObject = JSON.parse(JSON.stringify(data));\n  // Provider type based on initial configuration\n  let LoggedUserAddress = new Address(LoggedUseraddress);\n  let LoggedUserAccount = new Account(LoggedUserAddress);\n  let syncc = await LoggedUserAccount.sync(provider);\n  console.log(syncc);\n  //const signer = UserSigner.fromWallet(keyFileObject, \"u!D?G8Tf48fYL28\");\n  return {\n    signer,\n    LoggedUserAccount,\n    provider,\n  };\n};\n\nexport const MintTransaction = async (\n    price: number, tokens: number, signer: ISigner, UserAccount: Account, provider: ProxyProvider\n    ) => {\n    let mintx = getMintTransaction(\n      \"erd1qqqqqqqqqqqqqpgqjwnulxe3eyevsgyslqqfw8ev5juwd6ew5uhsk8ye2g\",\n      18000000,\n      tokens,\n      price,\n    );\n    mintx.setNonce(UserAccount.getNonceThenIncrement());\n    signer.sign(mintx);\n    await mintx.send(provider);\n    await mintx.awaitExecuted(provider);\n    const mnttxHash = mintx.getHash();\n    return mnttxHash;\n}\n\nexport const PriceTransaction = async (\n    signer: ISigner, UserAccount: Account, provider: ProxyProvider\n  ) => {\n    let pricetx = GetPrice(\n      \"erd1qqqqqqqqqqqqqpgqjwnulxe3eyevsgyslqqfw8ev5juwd6ew5uhsk8ye2g\",\n      18000000,\n    );\n    console.log(UserAccount.nonce);\n    pricetx.setNonce(UserAccount.getNonceThenIncrement());\n    await signer.sign(pricetx);\n    console.log(UserAccount);\n    await pricetx.send(provider);\n    await pricetx.awaitExecuted(provider);\n    const txHash = pricetx.getHash();\n    axios.defaults.headers.post['Access-Control-Allow-Origin'] = '*';\n    console.log(`Transaction: https://devnet-explorer.elrond.com/transactions/${txHash}`);\n    let explorer = `https://devnet-gateway.elrond.com/transaction/${txHash}?withResults=true`;\n    let res = await axios.get(explorer);\n    let value = res.data.data.transaction.smartContractResults[0].data;\n    console.log(value);\n    var result = value.substring(value.lastIndexOf(\"@\") + 1);\n    return parseInt(result, 16);\n  }"],"mappings":"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"},"metadata":{},"sourceType":"module"}